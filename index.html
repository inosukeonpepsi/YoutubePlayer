<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Doug's YouTube</title>

<style>
  :root{--bg:#0f1724;--card:#0b1220;--accent:#ff0066;--muted:#94a3b8;color-scheme:dark}
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial}
  body{
    background:linear-gradient(180deg,#071026 0%, #071020 60%);
    color:#e6eef8;
    padding:24px;
    box-sizing:border-box;
    position:relative;
  }

  .layout{
    display:flex;
    gap:20px;
  }

  .left{ flex:3; }
  .right{
    flex:2;
    background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    border-radius:12px;
    padding:16px;
    max-height:90vh;
    overflow-y:auto;
  }

  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:12px;
    padding:18px;
    box-shadow:0 6px 30px rgba(2,6,23,0.6);
  }

  .player-wrap{
    position:relative;
    padding-bottom:56.25%;
    height:0;
    overflow:hidden;
    border-radius:8px;
    background:#000;
  }
  #player{position:absolute;top:0;left:0;width:100%;height:100%;}

  input[type="text"], input[type="password"], input[type="range"]{
    background:transparent;
    border:1px solid rgba(255,255,255,0.06);
    padding:8px 10px;
    border-radius:8px;
    color:inherit;
  }

  button{
    background:rgba(255,255,255,0.03);
    border:none;
    padding:8px 12px;
    border-radius:8px;
    color:inherit;
    cursor:pointer;
  }

  .big-btn{padding:10px 14px;font-weight:600;}
  .controls{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px;align-items:center}
  .video-item{display:flex;gap:10px;margin-bottom:10px;cursor:pointer;background:#111a2a;border-radius:8px;padding:10px;transition:0.2s;}
  .video-item:hover{background:#1b2741;}
  .video-item img{width:120px;border-radius:6px;}

  /* LOGIN PANEL */
  #loginPanel{
    position:fixed;
    bottom:20px;
    left:20px;
    background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    padding:16px;
    border-radius:12px;
    width:220px;
    box-shadow:0 6px 20px rgba(0,0,0,0.5);
  }
  #loginPanel h3{margin-top:0;font-size:16px;}
  #loginPanel input{margin-bottom:8px;width:100%;}
  #loginPanel button{width:100%;margin-bottom:4px;}
  #currentUser{margin-top:8px;font-size:13px;color:var(--muted);}
</style>
</head>

<body>

<div class="layout">

  <!-- LEFT SIDE -->
  <div class="left">
    <div class="card">
      <h1>Doug's YouTube Player</h1>
      <p class="lead">Paste a YouTube URL below and press <strong>Load</strong>.</p>

      <div style="display:flex;gap:10px;margin-bottom:10px">
        <input id="videoInput" type="text" placeholder="YouTube URL or ID" style="flex:1" />
        <button id="loadBtn" class="big-btn">Load</button>
      </div>

      <div class="player-wrap"><div id="player"></div></div>

      <div class="controls">
        <div style="display:flex;gap:8px;align-items:center">
          <button id="playBtn">Play</button>
          <button id="pauseBtn">Pause</button>
          <button id="rewBtn">« 10s</button>
          <button id="fwdBtn">10s »</button>
        </div>

        <div style="flex:1;min-width:220px;display:flex;align-items:center;gap:8px">
          <input id="seek" type="range" min="0" max="100" value="0" style="flex:1" />
          <div class="time"><span id="current">0:00</span> / <span id="duration">0:00</span></div>
        </div>

        <div style="display:flex;align-items:center;gap:8px">
          <label for="volume">Vol</label>
          <input id="volume" class="volume" type="range" min="0" max="100" value="100" />
          <button id="fsBtn">Fullscreen</button>
        </div>
      </div>
    </div>
  </div>

  <!-- RIGHT SIDE -->
  <div class="right">
    <h2>Search Creator Videos</h2>
    <div style="display:flex;gap:10px;margin-bottom:10px">
      <input id="creatorName" type="text" placeholder="Enter creator name..." style="flex:1" />
      <button onclick="searchCreator()">Search</button>
    </div>

    <h3>Videos</h3>
    <div id="videoList"></div>
  </div>

</div>

<!-- LOGIN PANEL -->
<div id="loginPanel">
  <h3>Account</h3>
  <input type="text" id="username" placeholder="Username">
  <input type="password" id="password" placeholder="Password">
  <button onclick="signUp()">Sign Up</button>
  <button onclick="logIn()">Log In</button>
  <div id="currentUser">Not logged in</div>
</div>

<!-- Firebase SDKs -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, doc, setDoc, getDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT.firebaseio.com",
    projectId: "YOUR_PROJECT",
    storageBucket: "YOUR_PROJECT.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  let currentUserName = null;

  async function signUp() {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();
    if(!username || !password) return alert("Enter username & password");

    const userRef = doc(db, "users", username);
    const snap = await getDoc(userRef);
    if(snap.exists()){ alert("Username exists"); return; }

    await setDoc(userRef, { password, favorites: [] });
    alert("Account created!");
  }

  async function logIn() {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();
    if(!username || !password) return alert("Enter username & password");

    const userRef = doc(db, "users", username);
    const snap = await getDoc(userRef);
    if(!snap.exists()){ alert("User not found"); return; }

    if(snap.data().password !== password){ alert("Incorrect password"); return; }

    currentUserName = username;
    document.getElementById("currentUser").textContent = "Logged in: " + username;
    alert("Logged in!");
    loadFavorites();
  }

  async function addFavorite(channelId){
    if(!currentUserName) return alert("Log in first");
    const userRef = doc(db, "users", currentUserName);
    await updateDoc(userRef, { favorites: arrayUnion(channelId) });
    loadFavorites();
  }

  async function loadFavorites(){
    if(!currentUserName) return;
    const userRef = doc(db, "users", currentUserName);
    const snap = await getDoc(userRef);
    const favorites = snap.data()?.favorites || [];
    const list = document.getElementById("videoList");
    list.innerHTML = "";
    for(const ch of favorites){
      const div = document.createElement("div");
      div.className = "video-item";
      div.textContent = ch + " (favorite)";
      div.onclick = ()=>document.getElementById("creatorName").value = ch;
      list.appendChild(div);
    }
  }

  /* ----------------- YouTube Player ----------------- */
  let player=null;
  function extractVideoId(input){
    if(!input) return null;
    input=input.trim();
    const idRegex=/^[a-zA-Z0-9_-]{6,}$/;
    if(idRegex.test(input)) return input;
    try{
      const url=new URL(input.indexOf('http')===0?input:'https://'+input);
      if(url.hostname.includes('youtu.be')) return url.pathname.slice(1);
      if(url.searchParams.has('v')) return url.searchParams.get('v');
      const parts=url.pathname.split('/');
      const maybe=parts.pop()||parts.pop();
      if(maybe && idRegex.test(maybe)) return maybe;
    }catch(e){ const m=input.match(/v=([a-zA-Z0-9_-]{6,})/)||input.match(/youtu\.be\/([a-zA-Z0-9_-]{6,})/); if(m) return m[1]; }
    return null;
  }

  function onYouTubeIframeAPIReady(){ player = new YT.Player('player',{videoId:'',playerVars:{playsinline:1,rel:0,showinfo:0}}); }

  function loadFromInput(){ 
    const id=extractVideoId(document.getElementById("videoInput").value);
    if(!id) return alert("Invalid video");
    player.loadVideoById(id);
  }

  window.loadFromInput = loadFromInput;

  /* ----------------- Firebase + YouTube Integration ----------------- */
  const API_KEY = "AIzaSyDq9mq1cUuXpkE38juZiYJIDpg0oK8eVno";

  async function searchCreator(){
    const name=document.getElementById("creatorName").value.trim();
    if(!name) return alert("Enter creator name");

    const channelRes = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=channel&q=${encodeURIComponent(name)}&key=${API_KEY}`);
    const channelData = await channelRes.json();
    if(!channelData.items?.length) return alert("No channel found");

    const channelId = channelData.items[0].id.channelId;
    const detailsRes = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=contentDetails&id=${channelId}&key=${API_KEY}`);
    const detailsData = await detailsRes.json();
    const uploadsId = detailsData.items[0].contentDetails.relatedPlaylists.uploads;

    let videos=[], nextPage="";
    while(true){
      const vidsRes = await fetch(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${uploadsId}&maxResults=50&pageToken=${nextPage}&key=${API_KEY}`);
      const vidsData = await vidsRes.json();
      videos.push(...vidsData.items);
      if(!vidsData.nextPageToken) break;
      nextPage = vidsData.nextPageToken;
    }

    const list=document.getElementById("videoList");
    list.innerHTML="";
    for(const v of videos){
      const vidId = v.snippet.resourceId.videoId;
      const thumb = v.snippet.thumbnails.medium.url;
      const title = v.snippet.title;
      const div = document.createElement("div");
      div.className="video-item";
      div.innerHTML = `<img src="${thumb}"><div><strong>${title}</strong></div>`;
      div.onclick = ()=>player.loadVideoById(vidId);
      list.appendChild(div);

      // Add favorite button if logged in
      if(currentUserName){
        const favBtn = document.createElement("button");
        favBtn.textContent="★";
        favBtn.style.marginLeft="8px";
        favBtn.onclick = (e)=>{ e.stopPropagation(); addFavorite(name); };
        div.appendChild(favBtn);
      }
    }
  }

</script>
<script src="https://www.youtube.com/iframe_api"></script>
</body>
</html>
