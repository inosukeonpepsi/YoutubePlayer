<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Doug's YouTube Player + Favorites</title>

<style>
:root{--bg:#0f1724;--card:#0b1220;--accent:#ff0066;--muted:#94a3b8;color-scheme:dark}
html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial}
body{background:linear-gradient(180deg,#071026 0%, #071020 60%);color:#e6eef8;padding:24px;box-sizing:border-box;}

.layout{display:flex;gap:20px;}
.left{flex:3;}
.right{flex:2;background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));border-radius:12px;padding:16px;max-height:90vh;overflow-y:auto;}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;box-shadow:0 6px 30px rgba(2,6,23,0.6);}
.player-wrap{position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:8px;background:#000;}
#player{position:absolute;top:0;left:0;width:100%;height:100%;}
input[type="text"], input[type="range"], input[type="password"]{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:inherit;}
button{background:rgba(255,255,255,0.03);border:none;padding:8px 12px;border-radius:8px;color:inherit;cursor:pointer;}
.big-btn{padding:10px 14px;font-weight:600;}
.controls{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px;align-items:center}
.video-item{display:flex;gap:10px;margin-bottom:10px;cursor:pointer;background:#111a2a;border-radius:8px;padding:10px;transition:0.2s;}
.video-item:hover{background:#1b2741;}
.video-item img{width:120px;border-radius:6px;}
.fav-btn{margin-left:auto;background:var(--accent);}
#authPanel{margin-top:16px;padding:10px;border:1px solid rgba(255,255,255,0.1);border-radius:8px;}
</style>
</head>

<body>

<div class="layout">

<!-- LEFT: MAIN PLAYER -->
<div class="left">
  <div class="card">
    <h1>Doug's YouTube Player</h1>
    <p class="lead">Paste a YouTube URL below and press <strong>Load</strong>.</p>

    <div class="flex" style="display:flex;gap:10px;margin-bottom:10px">
      <input id="videoInput" type="text" placeholder="YouTube URL or ID" style="flex:1" />
      <button id="loadBtn" class="big-btn">Load</button>
    </div>

    <div class="player-wrap"><div id="player"></div></div>

    <div class="controls">
      <div style="display:flex;gap:8px;align-items:center">
        <button id="playBtn">Play</button>
        <button id="pauseBtn">Pause</button>
        <button id="rewBtn">« 10s</button>
        <button id="fwdBtn">10s »</button>
      </div>

      <div style="flex:1;min-width:220px;display:flex;align-items:center;gap:8px">
        <input id="seek" type="range" min="0" max="100" value="0" style="flex:1" />
        <div class="time"><span id="current">0:00</span> / <span id="duration">0:00</span></div>
      </div>

      <div style="display:flex;align-items:center;gap:8px">
        <label for="volume">Vol</label>
        <input id="volume" class="volume" type="range" min="0" max="100" value="100" />
        <button id="fsBtn">Fullscreen</button>
      </div>
    </div>
  </div>
</div>

<!-- RIGHT: SEARCH + FAVORITES -->
<div class="right">
  <h2>Search Creator Videos</h2>
  <div style="display:flex;gap:10px;margin-bottom:10px">
    <input id="creatorName" type="text" placeholder="Enter creator name..." style="flex:1" />
    <button onclick="searchCreator()">Search</button>
  </div>

  <h3>Videos</h3>
  <div id="videoList"></div>

  <div id="authPanel">
    <h3>Account</h3>
    <input id="username" type="text" placeholder="Username" style="width:100%;margin-bottom:5px">
    <input id="password" type="password" placeholder="Password" style="width:100%;margin-bottom:5px">
    <div style="display:flex;gap:5px;">
      <button onclick="signup()">Sign Up</button>
      <button onclick="login()">Login</button>
    </div>
    <h4>Favorites</h4>
    <div id="favList"></div>
  </div>
</div>

</div>

<!-- YouTube API -->
<script src="https://www.youtube.com/iframe_api"></script>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
import { getDatabase, ref, set, get, child, update } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-database.js";

// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyBJmq4jD07NvhlNtaWGlk-XkLrswKmV1uE",
  authDomain: "doug-s.firebaseapp.com",
  databaseURL: "https://doug-s-default-rtdb.firebaseio.com",
  projectId: "doug-s",
  storageBucket: "doug-s.appspot.com",
  messagingSenderId: "1052685938302",
  appId: "1:1052685938302:web:6994005eb376d59f79f22f"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
</script>

<script>
/* ------------------ YOUTUBE PLAYER ------------------ */
const API_KEY = "AIzaSyDq9mq1cUuXpkE38juZiYJIDpg0oK8eVno";

function extractVideoId(input){
  if(!input) return null;
  input=input.trim();
  const idRegex=/^[a-zA-Z0-9_-]{6,}$/;
  if(idRegex.test(input)) return input;
  try{
    const url=new URL(input.indexOf('http')===0?input:'https://'+input);
    if(url.hostname.includes('youtu.be')) return url.pathname.slice(1);
    if(url.searchParams.has('v')) return url.searchParams.get('v');
    const parts=url.pathname.split('/');
    const maybe=parts.pop()||parts.pop();
    if(maybe && idRegex.test(maybe)) return maybe;
  }catch(e){
    const m=input.match(/v=([a-zA-Z0-9_-]{6,})/)||input.match(/youtu\.be\/([a-zA-Z0-9_-]{6,})/);
    if(m) return m[1];
  }
  return null;
}

let player=null;
let updateTimer=null;

function onYouTubeIframeAPIReady(){
  player=new YT.Player('player',{
    videoId:'',
    playerVars:{playsinline:1,rel:0,showinfo:0},
    events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}
  });
}

function onPlayerReady(){
  loadBtn.onclick=loadFromInput;
  playBtn.onclick=()=>player.playVideo();
  pauseBtn.onclick=()=>player.pauseVideo();
  rewBtn.onclick=()=>seekBy(-10);
  fwdBtn.onclick=()=>seekBy(10);
  volume.oninput=e=>player.setVolume(e.target.value);
  seek.oninput=onSeekInput;
  fsBtn.onclick=toggleFullscreen;
  updateTimer=setInterval(updateUI,500);
}

function loadFromInput(){
  const raw=videoInput.value;
  const id=extractVideoId(raw);
  if(!id) return alert("Couldn't read video ID.");
  player.loadVideoById(id);
}

function seekBy(s){player.seekTo(Math.max(0,player.getCurrentTime()+s),true);}
function onSeekInput(e){player.seekTo(player.getDuration()*(e.target.value/100),true);}
function updateUI(){
  if(!player) return;
  const dur=player.getDuration()||0;
  const cur=player.getCurrentTime()||0;
  seek.value = dur?Math.round((cur/dur)*100):0;
  current.textContent=formatTime(cur);
  duration.textContent=formatTime(dur);
  volume.value=player.getVolume();
}
function formatTime(s){s=Math.max(0,Math.floor(s||0));return Math.floor(s/60)+":"+(s%60<10?"0":"")+(s%60);}
function toggleFullscreen(){const el=document.querySelector('.player-wrap');if(!document.fullscreenElement) el.requestFullscreen(); else document.exitFullscreen();}

/* ------------------ SEARCH & DISPLAY ------------------ */
async function searchCreator(){
  const name = creatorName.value.trim();
  if(!name) return alert("Enter a creator name.");

  const channelReq = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=channel&q=${encodeURIComponent(name)}&key=${API_KEY}`);
  const channelData = await channelReq.json();
  if(!channelData.items?.length) return alert("No channel found.");
  const channelId = channelData.items[0].id.channelId;

  const detailsReq = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=contentDetails&id=${channelId}&key=${API_KEY}`);
  const detailsData = await detailsReq.json();
  const uploadsPlaylistId = detailsData.items[0].contentDetails.relatedPlaylists.uploads;

  let videos = [], nextPage = "";
  while(true){
    const vidReq = await fetch(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&playlistId=${uploadsPlaylistId}&maxResults=50&pageToken=${nextPage}&key=${API_KEY}`);
    const vidData = await vidReq.json();
    videos.push(...vidData.items);
    if(!vidData.nextPageToken) break;
    nextPage = vidData.nextPageToken;
  }

  displayVideos(videos, channelId);
}

function displayVideos(videos, channelId){
  const list=document.getElementById("videoList");
  list.innerHTML="";
  videos.forEach(v=>{
    const vid=v.snippet.resourceId.videoId;
    const title=v.snippet.title;
    const thumb=v.snippet.thumbnails.medium.url;

    const item=document.createElement("div");
    item.className="video-item";
    item.innerHTML=`<img src="${thumb}"><div><strong>${title}</strong></div>`;
    item.onclick=()=>player.loadVideoById(vid);

    const favBtn=document.createElement("button");
    favBtn.textContent="♥";
    favBtn.className="fav-btn";
    favBtn.onclick=(e)=>{
      e.stopPropagation();
      addFavorite(channelId);
    };
    item.appendChild(favBtn);

    list.appendChild(item);
  });
}

/* ------------------ FIREBASE FAVORITES ------------------ */
let currentUser = null;

function signup(){
  const user=username.value.trim(), pass=password.value.trim();
  if(!user||!pass) return alert("Enter username & password");
  set(ref(db, 'users/' + user), {password:pass, favorites:{}}).then(()=>{
    alert("Account created!");
    currentUser=user;
    loadFavorites();
  }).catch(e=>alert(e));
}

function login(){
  const user=username.value.trim(), pass=password.value.trim();
  if(!user||!pass) return alert("Enter username & password");
  get(child(ref(db), 'users/' + user)).then(snapshot=>{
    if(snapshot.exists() && snapshot.val().password===pass){
      alert("Logged in!");
      currentUser=user;
      loadFavorites();
    } else alert("Invalid credentials");
  }).catch(e=>alert(e));
}

function addFavorite(channelId){
  if(!currentUser) return alert("Login first");
  const favRef = ref(db, 'users/' + currentUser + '/favorites/' + channelId);
  set(favRef, true).then(loadFavorites);
}

function loadFavorites(){
  if(!currentUser) return;
  const favRef = ref(db, 'users/' + currentUser + '/favorites');
  get(favRef).then(snapshot=>{
    const favList=document.getElementById("favList");
    favList.innerHTML="";
    const data = snapshot.val()||{};
    Object.keys(data).forEach(ch=>{
      const btn=document.createElement("button");
      btn.textContent=ch;
      btn.style.width="100%";
      btn.onclick=()=>{
        creatorName.value=ch;
        searchCreator();
      };
      favList.appendChild(btn);
    });
  });
}
</script>
</body>
</html>
